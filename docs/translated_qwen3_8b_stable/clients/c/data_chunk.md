---
---
layout: docu
redirect_from:
- /docs/api/c/data_chunk
- /docs/api/c/data_chunk/
- /docs/clients/c/data_chunk
title: 数据块
---

<!-- markdownlint-disable MD001 -->

数据块代表表的一个水平切片。它们包含若干个[vectors]({% link docs/stable/clients/c/vector.md %})，每个vector可以最多存储`VECTOR_SIZE`行数据。vector的大小可以通过`duckdb_vector_size`函数获取，并且是可配置的，但通常设置为`2048`。

数据块和vector是DuckDB原生用于存储和表示数据的方式。因此，数据块接口是与DuckDB交互最高效的方式。不过，正确使用数据块API与DuckDB交互需要了解DuckDB的内部vector格式。

数据块可以以两种方式使用：

* **读取数据**：数据块可以通过`duckdb_fetch_chunk`方法从查询结果中获取，或者作为用户定义函数的输入。在这种情况下，可以使用[vectors方法]({% link docs/stable/clients/c/vector.md %})来读取单个值。
* **写入数据**：数据块可以通过`duckdb_create_data_chunk`创建。然后，数据块可以填充值，并通过`duckdb_append_data_chunk`写入数据库。

与数据块交互的主要方式是使用`duckdb_data_chunk_get_vector`方法获取数据块的内部vector。之后，可以使用[vectors方法]({% link docs/stable/clients/c/vector.md %})来读取或写入各个vector。

## API参考概述

<!-- This section is generated by scripts/generate_c_api_docs.py -->

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">duckdb_data_chunk</span> <a href="#duckdb_create_data_chunk"><span class="nf">duckdb_create_data_chunk</span></a>(<span class="kt">duckdb_logical_type</span> *<span class="nv">types</span>, <span class="kt">idx_t</span> <span class="nv">column_count</span>);
<span class="kt">void</span> <a href="#duckdb_destroy_data_chunk"><span class="nf">duckdb_destroy_data_chunk</span></a>(<span class="kt">duckdb_data_chunk</span> *<span class="nv">chunk</span>);
<span class="kt">void</span> <a href="#duckdb_data_chunk_reset"><span class="nf">duckdb_data_chunk_reset</span></a>(<span class="kt">duckdb_data_chunk</span> <span class="nv">chunk</span>);
<span class="kt">idx_t</span> <a href="#duckdb_data_chunk_get_column_count"><span class="nf">duckdb_data_chunk_get_column_count</span></a>(<span class="kt">duckdb_data_chunk</span> <span class="nv">chunk</span>);
<span class="kt">duckdb_vector</span> <a href="#duckdb_data_chunk_get_vector"><span class="nf">duckdb_data_chunk_get_vector</span></a>(<span class="kt">duckdb_data_chunk</span> <span class="nv">chunk</span>, <span class="kt">idx_t</span> <span class="nv">col_idx</span>);
<span class="kt">idx_t</span> <a href="#duckdb_data_chunk_get_size"><span class="nf">duckdb_data_chunk_get_size</span></a>(<span class="kt">duckdb_data_chunk</span> <span class="nv">chunk</span>);
<span class="kt">void</span> <a href="#duckdb_data_chunk_set_size"><span class="nf">duckdb_data_chunk_set_size</span></a>(<span class="kt">duckdb_data_chunk</span> <span class="nv">chunk</span>, <span class="kt">idx_t</span> <span class="nv">size</span>);
</code></pre></div></div>

#### `duckdb_create_data_chunk`

创建一个指定列类型的空数据块。
结果必须使用`duckdb_destroy_data_chunk`进行销毁。

##### 语法

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">duckdb_data_chunk</span> <span class="nv">duckdb_create_data_chunk</span>(<span class="nv">
</span>  <span class="kt">duckdb_logical_type</span> *<span class="nv">types</span>,<span class="nv">
</span>  <span class="kt">idx_t</span> <span class="nv">column_count
</span>);
</code></pre></div></div>

##### 参数

* `types`：列类型数组。列类型不能包含ANY和INVALID类型。
* `column_count`：列数。

##### 返回值

数据块。

<br>

#### `duckdb_destroy_data_chunk`

销毁数据块并释放其所有内存。

##### 语法

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">void</span> <span class="nv">duckdb_destroy_data_chunk</span>(<span class="nv">
</span>  <span class="kt">duckdb_data_chunk</span> *<span class="nv">chunk
</span>);
</code></pre></div></div>

##### 参数

* `chunk`：要销毁的数据块。

<br>

#### `duckdb_data_chunk_reset`

重置数据块，清除有效性掩码并将数据块的基数设置为0。
调用此方法后，必须调用`duckdb_vector_get_validity`和`duckdb_vector_get_data`来获取当前数据和有效性指针。

##### 语法

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">void</span> <span class="nv">duckdb_data_chunk_reset</span>(<span class="nv">
</span>  <span class="kt">duckdb_data_chunk</span> <span class="nv">chunk
</span>);
</code></pre></div></div>

##### 参数

* `chunk`：要重置的数据块。

<br>

#### `duckdb_data_chunk_get_column_count`

获取数据块中的列数。

##### 语法

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">idx_t</span> <span class="nv">duckdb_data_chunk_get_column_count</span>(<span class="nv">
</span>  <span class="kt">duckdb_data_chunk</span> <span class="nv">chunk
</span>);
</code></pre></div></div>

##### 参数

* `chunk`：获取数据的数据块

##### 返回值

数据块中的列数

<br>

#### `duckdb_data_chunk_get_vector`

获取数据块中指定列索引处的vector。

vector指针在数据块存活期间有效。它不需要被销毁。

##### 语法

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">duckdb_vector</span> <span class="nv">duckdb_data_chunk_get_vector</span>(<span class="nv">
</span>  <span class="kt">duckdb_data_chunk</span> <span class="nv">chunk</span>,<span class="nv">
</span>  <span class="kt">idx_t</span> <span class="nv">col_idx
</span>);
</code></pre></div></div>

##### 参数

* `chunk`：获取数据的数据块

##### 返回值

vector

<br>

#### `duckdb_data_chunk_get_size`

获取数据块中的当前元组数。

##### 语法

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">idx_t</span> <span class="nv">duckdb_data_chunk_get_size</span>(<span class="nv">
</span>  <span class="kt">duckdb_data_chunk</span> <span class="nv">chunk
</span>);
</code></pre></div></div>

##### 参数

* `chunk`：获取数据的数据块

##### 返回值

数据块中的元组数

<br>

#### `duckdb_data_chunk_set_size`

设置数据块中的当前元组数。

##### 语法

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">void</span> <span class="nv">duckdb_data_chunk_set_size</span>(<span class="nv">
</span>  <span class="kt">duckdb_data_chunk</span> <span class="nv">chunk</span>,<span class="nv">
</span>  <span class="kt">idx_t</span> <span class="nv">size
</span>);
</code></pre></div></div>

##### 参数

* `chunk`：设置大小的数据块
* `size`：数据块中的元组数

<br>